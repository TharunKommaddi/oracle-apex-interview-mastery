<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - APEX Interview Mastery</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            text-align: center;
            border: 1px solid var(--border-light);
        }

        .requests-section {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            margin-bottom: 2rem;
        }

        .request-item {
            background: var(--bg-tertiary);
            padding: 1.5rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary);
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-md);
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending { background: var(--warning); color: white; }
        .status-approved { background: var(--success); color: white; }
        .status-rejected { background: var(--error); color: white; }

        .btn-group {
            margin-top: 1rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            margin-right: 0.5rem;
        }

        .form-section {
            background: var(--bg-card);
            padding: 2rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .notification {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: var(--radius-md);
            display: none;
        }

        .notification.success {
            background: rgba(72, 187, 120, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .notification.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }

        @media (max-width: 768px) {
            .admin-container { margin: 1rem; padding: 1rem; }
            .request-header { flex-direction: column; gap: 0.5rem; }
            .btn-group { text-align: center; }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>ðŸ”§ Admin Dashboard</h1>
            <p>Manage access requests for APEX Interview Mastery</p>
            <button class="btn" onclick="location.reload()">
                <i class="fas fa-sync"></i> Refresh
            </button>
            <button class="btn btn-secondary" onclick="location.href='index.html'">
                <i class="fas fa-home"></i> Back to Site
            </button>
        </div>

        <div class="notification" id="notification"></div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalRequests">0</div>
                <div class="stat-label">Total Requests</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingRequests">0</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="approvedUsers">0</div>
                <div class="stat-label">Approved</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="rejectedRequests">0</div>
                <div class="stat-label">Rejected</div>
            </div>
        </div>

        <!-- Quick Approval Form -->
        <div class="form-section">
            <h2><i class="fas fa-user-check"></i> Quick Approval</h2>
            <form id="quickApprovalForm">
                <div class="form-grid">
                    <input type="email" class="form-input" id="approvalEmail" placeholder="Email" required>
                    <input type="text" class="form-input" id="approvalName" placeholder="Full Name">
                    <select class="form-input" id="approvalType" required>
                        <option value="">Select Access Type</option>
                        <option value="student">Student</option>
                        <option value="developer">Developer</option>
                        <option value="admin">Admin</option>
                    </select>
                    <input type="text" class="form-input" id="approvalPassword" value="TempPass123!" placeholder="Password">
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-check"></i> Approve User
                </button>
            </form>
        </div>

        <!-- Pending Requests -->
        <div class="requests-section">
            <h2><i class="fas fa-clock"></i> Pending Requests</h2>
            <div id="pendingRequestsList"></div>
        </div>

        <!-- All Requests -->
        <div class="requests-section">
            <h2><i class="fas fa-list"></i> All Requests</h2>
            <div id="allRequestsList"></div>
        </div>
    </div>

    <script>
        // Storage keys
        const STORAGE_KEY = 'apex_access_requests';
        const APPROVED_USERS_KEY = 'apex_approved_users';

        // Admin functions
        const AdminDashboard = {
            // Load and display data
            loadData() {
                const requests = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                const approvedUsers = JSON.parse(localStorage.getItem(APPROVED_USERS_KEY) || '[]');

                this.updateStats(requests, approvedUsers);
                this.displayPendingRequests(requests);
                this.displayAllRequests(requests);
            },

            // Update statistics
            updateStats(requests, approvedUsers) {
                const pending = requests.filter(r => r.status === 'pending').length;
                const rejected = requests.filter(r => r.status === 'rejected').length;

                document.getElementById('totalRequests').textContent = requests.length;
                document.getElementById('pendingRequests').textContent = pending;
                document.getElementById('approvedUsers').textContent = approvedUsers.length;
                document.getElementById('rejectedRequests').textContent = rejected;
            },

            // Display pending requests
            displayPendingRequests(requests) {
                const pending = requests.filter(r => r.status === 'pending');
                const container = document.getElementById('pendingRequestsList');

                if (pending.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--text-muted);">No pending requests</p>';
                    return;
                }

                container.innerHTML = pending.map(request => `
                    <div class="request-item">
                        <div class="request-header">
                            <div>
                                <strong>${request.fullName}</strong><br>
                                <span style="color: var(--text-muted);">${request.email}</span>
                            </div>
                            <span class="status-badge status-${request.status}">${request.status}</span>
                        </div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                            <p><strong>Access Type:</strong> ${request.accessType}</p>
                            <p><strong>Experience:</strong> ${request.experience || 'Not specified'}</p>
                            <p><strong>Submitted:</strong> ${new Date(request.submittedAt).toLocaleDateString()}</p>
                            <p><strong>Reason:</strong></p>
                            <p style="font-style: italic; background: var(--bg-secondary); padding: 0.75rem; border-radius: var(--radius-sm); margin-top: 0.5rem;">
                                ${request.reason}
                            </p>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-success btn-small" onclick="AdminDashboard.approveUser('${request.email}', '${request.fullName}', '${request.accessType}')">
                                <i class="fas fa-check"></i> Approve
                            </button>
                            <button class="btn btn-error btn-small" onclick="AdminDashboard.rejectUser('${request.email}')">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </div>
                    </div>
                `).join('');
            },

            // Display all requests
            displayAllRequests(requests) {
                const container = document.getElementById('allRequestsList');

                if (requests.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--text-muted);">No requests found</p>';
                    return;
                }

                const sorted = requests.sort((a, b) => new Date(b.submittedAt) - new Date(a.submittedAt));

                container.innerHTML = sorted.map(request => `
                    <div class="request-item">
                        <div class="request-header">
                            <div>
                                <strong>${request.fullName}</strong><br>
                                <span style="color: var(--text-muted);">${request.email}</span>
                            </div>
                            <span class="status-badge status-${request.status}">${request.status}</span>
                        </div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                            <p><strong>Request ID:</strong> ${request.requestId}</p>
                            <p><strong>Access Type:</strong> ${request.accessType}</p>
                            <p><strong>Submitted:</strong> ${new Date(request.submittedAt).toLocaleDateString()}</p>
                            ${request.approvedAt ? `<p><strong>Approved:</strong> ${new Date(request.approvedAt).toLocaleDateString()}</p>` : ''}
                            ${request.rejectedAt ? `<p><strong>Rejected:</strong> ${new Date(request.rejectedAt).toLocaleDateString()}</p>` : ''}
                        </div>
                    </div>
                `).join('');
            },

            // Approve user
            approveUser(email, fullName, accessType, password = 'TempPass123!') {
                try {
                    // Get current data
                    const approvedUsers = JSON.parse(localStorage.getItem(APPROVED_USERS_KEY) || '[]');
                    const requests = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                    
                    // Find request
                    const requestIndex = requests.findIndex(req => req.email.toLowerCase() === email.toLowerCase());
                    if (requestIndex === -1) {
                        this.showNotification('Request not found', 'error');
                        return false;
                    }
                    
                    // Check if already approved
                    if (approvedUsers.some(user => user.email.toLowerCase() === email.toLowerCase())) {
                        this.showNotification('User already approved', 'error');
                        return false;
                    }
                    
                    // Create approved user
                    const approvedUser = {
                        email: email.toLowerCase(),
                        fullName: fullName,
                        accessType: accessType,
                        password: password,
                        approvedAt: new Date().toISOString(),
                        requestId: requests[requestIndex].requestId
                    };
                    
                    // Add to approved users
                    approvedUsers.push(approvedUser);
                    localStorage.setItem(APPROVED_USERS_KEY, JSON.stringify(approvedUsers));



// Update request status
                   requests[requestIndex].status = 'approved';
                   requests[requestIndex].approvedAt = new Date().toISOString();
                   localStorage.setItem(STORAGE_KEY, JSON.stringify(requests));
                   
                   this.showNotification(`âœ… User ${email} approved successfully! Send them their credentials.`, 'success');
                   this.loadData();
                   
                   // Show credentials info
                   setTimeout(() => {
                       alert(`User Approved!\n\nEmail to send to user:\n\nSubject: Access Approved - APEX Interview Mastery\n\nHi ${fullName},\n\nYour access has been approved!\n\nLogin at: ${window.location.origin}/login.html\nEmail: ${email}\nPassword: ${password}\n\nPlease change your password after first login.\n\nWelcome to APEX Interview Mastery!`);
                   }, 1000);
                   
                   return true;
               } catch (error) {
                   this.showNotification('Error approving user: ' + error.message, 'error');
                   return false;
               }
           },

           // Reject user
           rejectUser(email, reason = 'Request did not meet requirements') {
               try {
                   const requests = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                   const requestIndex = requests.findIndex(req => req.email.toLowerCase() === email.toLowerCase());
                   
                   if (requestIndex === -1) {
                       this.showNotification('Request not found', 'error');
                       return false;
                   }
                   
                   requests[requestIndex].status = 'rejected';
                   requests[requestIndex].rejectedAt = new Date().toISOString();
                   requests[requestIndex].rejectionReason = reason;
                   localStorage.setItem(STORAGE_KEY, JSON.stringify(requests));
                   
                   this.showNotification(`âŒ User ${email} rejected`, 'success');
                   this.loadData();
                   return true;
               } catch (error) {
                   this.showNotification('Error rejecting user: ' + error.message, 'error');
                   return false;
               }
           },

           // Show notification
           showNotification(message, type = 'success') {
               const notification = document.getElementById('notification');
               notification.textContent = message;
               notification.className = `notification ${type}`;
               notification.style.display = 'block';

               setTimeout(() => {
                   notification.style.display = 'none';
               }, 5000);
           }
       };

       // Quick approval form handler
       document.getElementById('quickApprovalForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           const email = document.getElementById('approvalEmail').value.trim();
           const name = document.getElementById('approvalName').value.trim();
           const type = document.getElementById('approvalType').value;
           const password = document.getElementById('approvalPassword').value.trim();

           if (!email || !type || !password) {
               AdminDashboard.showNotification('Please fill in all required fields', 'error');
               return;
           }

           if (AdminDashboard.approveUser(email, name, type, password)) {
               this.reset();
               document.getElementById('approvalPassword').value = 'TempPass123!';
           }
       });

       // Load data on page load
       document.addEventListener('DOMContentLoaded', function() {
           AdminDashboard.loadData();
           
           // Auto-refresh every 30 seconds
           setInterval(() => {
               AdminDashboard.loadData();
           }, 30000);
       });

       // Console helpers
       window.AdminConsole = {
           viewRequests: () => {
               const requests = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
               console.table(requests);
               return requests;
           },
           viewApprovedUsers: () => {
               const users = JSON.parse(localStorage.getItem(APPROVED_USERS_KEY) || '[]');
               console.table(users);
               return users;
           },
           approve: (email, name, type, password = 'TempPass123!') => {
               return AdminDashboard.approveUser(email, name, type, password);
           },
           reject: (email, reason) => {
               return AdminDashboard.rejectUser(email, reason);
           },
           clearAll: () => {
               if (confirm('This will delete ALL data. Are you sure?')) {
                   localStorage.removeItem(STORAGE_KEY);
                   localStorage.removeItem(APPROVED_USERS_KEY);
                   AdminDashboard.loadData();
                   console.log('All data cleared');
               }
           }
       };

       console.log('ðŸ”§ Admin Dashboard loaded');
       console.log('ðŸ“Š Console commands: AdminConsole.viewRequests(), AdminConsole.approve(email, name, type, password)');
   </script>
</body>
</html>
              
